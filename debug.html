<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ProviderVault Debug</title>
    <style>
        body {
            font-family: system-ui, -apple-system, sans-serif;
            padding: 2rem;
            background: #f8fafc;
        }
        .container {
            max-width: 1200px;
            margin: 0 auto;
            background: white;
            padding: 2rem;
            border-radius: 8px;
            box-shadow: 0 1px 3px rgba(0,0,0,0.1);
        }
        h1 {
            color: #1e293b;
            margin-bottom: 1rem;
        }
        pre {
            background: #f1f5f9;
            padding: 1rem;
            border-radius: 6px;
            overflow-x: auto;
            font-size: 0.875rem;
        }
        .section {
            margin-bottom: 2rem;
        }
        .btn {
            background: #3b82f6;
            color: white;
            border: none;
            padding: 0.5rem 1rem;
            border-radius: 6px;
            cursor: pointer;
            margin-right: 0.5rem;
        }
        .btn:hover {
            background: #2563eb;
        }
        .btn-danger {
            background: #ef4444;
        }
        .btn-danger:hover {
            background: #dc2626;
        }
        .info {
            padding: 1rem;
            background: #eff6ff;
            border: 1px solid #bfdbfe;
            border-radius: 6px;
            margin-bottom: 1rem;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>ProviderVault Debug Console</h1>

        <div class="info">
            <strong>Instructions:</strong> This page shows what's stored in your browser's localStorage for ProviderVault.
        </div>

        <div style="margin-bottom: 2rem;">
            <button class="btn" onclick="loadData()">Refresh Data</button>
            <button class="btn" onclick="fixProviderOrganizations()">Fix Provider Organization IDs</button>
            <button class="btn" onclick="fixContractOrganizations()">Fix Contract Organization IDs</button>
            <button class="btn" onclick="fixPayerOrganizations()">Fix Payer Organization IDs</button>
            <button class="btn" onclick="fixLocationOrganizations()">Fix Location Organization IDs</button>
            <button class="btn btn-danger" onclick="clearProviders()">Clear All Providers</button>
            <button class="btn" onclick="window.location.href='index.html'">Back to App</button>
        </div>

        <div id="fix-message" style="display: none; padding: 1rem; background: #dcfce7; border: 1px solid #86efac; border-radius: 6px; margin-bottom: 1rem;">
        </div>

        <div class="section">
            <h2>Current Organization</h2>
            <pre id="current-org">Loading...</pre>
        </div>

        <div class="section">
            <h2>All Organizations</h2>
            <pre id="organizations">Loading...</pre>
        </div>

        <div class="section">
            <h2>All Providers</h2>
            <pre id="providers">Loading...</pre>
        </div>

        <div class="section">
            <h2>All Locations</h2>
            <pre id="locations">Loading...</pre>
        </div>
    </div>

    <script>
        function loadData() {
            // Current Organization
            const currentOrg = localStorage.getItem('pvCurrentOrganization');
            document.getElementById('current-org').textContent = currentOrg || 'No organization selected';

            // Organizations
            const orgs = localStorage.getItem('pvOrganizations');
            if (orgs) {
                const parsedOrgs = JSON.parse(orgs);
                document.getElementById('organizations').textContent = JSON.stringify(parsedOrgs, null, 2);
            } else {
                document.getElementById('organizations').textContent = 'No organizations found';
            }

            // Providers
            const providers = localStorage.getItem('pvProviders');
            if (providers) {
                const parsedProviders = JSON.parse(providers);
                document.getElementById('providers').textContent = JSON.stringify(parsedProviders, null, 2);

                // Show summary
                console.log('Total providers:', parsedProviders.length);
                parsedProviders.forEach(p => {
                    console.log(`Provider: ${p.name || `${p.firstName} ${p.lastName}`}, ID: ${p.id}, OrgID: ${p.organizationId}`);
                    console.log('  - Licenses:', p.licenses?.length || 0);
                    console.log('  - Practice Locations:', p.practiceLocations?.length || 0);
                    console.log('  - Hospital Affiliations:', p.hospitalAffiliations?.length || 0);
                    console.log('  - Credentialing Contacts:', p.credentialingContacts?.length || 0);
                    console.log('  - Liability Insurance:', p.liabilityInsurance?.length || 0);
                    console.log('  - Professional References:', p.professionalReferences?.length || 0);
                });
            } else {
                document.getElementById('providers').textContent = 'No providers found';
            }

            // Locations
            const locations = localStorage.getItem('pvLocations');
            if (locations) {
                const parsedLocations = JSON.parse(locations);
                document.getElementById('locations').textContent = JSON.stringify(parsedLocations, null, 2);
            } else {
                document.getElementById('locations').textContent = 'No locations found';
            }
        }

        function clearProviders() {
            if (confirm('Are you sure you want to clear all providers? This cannot be undone.')) {
                localStorage.removeItem('pvProviders');
                alert('All providers have been cleared. Reload the main app to see changes.');
                loadData();
            }
        }

        function fixProviderOrganizations() {
            const currentOrgData = localStorage.getItem('pvCurrentOrganization');
            if (!currentOrgData) {
                alert('No current organization found. Please select an organization in the main app first.');
                return;
            }

            const currentOrg = JSON.parse(currentOrgData);
            const providersData = localStorage.getItem('pvProviders');

            if (!providersData) {
                alert('No providers found to fix.');
                return;
            }

            const providers = JSON.parse(providersData);
            let fixedCount = 0;
            const fixedProviders = [];

            providers.forEach(provider => {
                if (!provider.organizationId || provider.organizationId === 'null' || provider.organizationId === null) {
                    provider.organizationId = currentOrg.id;
                    fixedCount++;
                    fixedProviders.push(provider.name || `${provider.firstName} ${provider.lastName}`);
                }
            });

            if (fixedCount > 0) {
                localStorage.setItem('pvProviders', JSON.stringify(providers));
                const message = `✓ Fixed ${fixedCount} provider(s) and assigned them to "${currentOrg.name}":\n${fixedProviders.join(', ')}`;
                document.getElementById('fix-message').style.display = 'block';
                document.getElementById('fix-message').innerHTML = '<strong>Success!</strong> ' + message.replace(/\n/g, '<br>');
                loadData();
                setTimeout(() => {
                    alert('Providers fixed! Go back to the main app and refresh the page (Ctrl+Shift+R) to see the changes.');
                }, 500);
            } else {
                alert('No providers needed fixing. All providers already have valid organization IDs.');
            }
        }

        function fixContractOrganizations() {
            const currentOrgData = localStorage.getItem('pvCurrentOrganization');
            if (!currentOrgData) {
                alert('No current organization found. Please select an organization in the main app first.');
                return;
            }

            const currentOrg = JSON.parse(currentOrgData);
            const contractsData = localStorage.getItem('pvContracts');

            if (!contractsData) {
                alert('No contracts found to fix.');
                return;
            }

            const contracts = JSON.parse(contractsData);
            let fixedCount = 0;
            const fixedContracts = [];

            contracts.forEach(contract => {
                if (!contract.organizationId || contract.organizationId === 'null' || contract.organizationId === null) {
                    contract.organizationId = currentOrg.id;
                    fixedCount++;
                    fixedContracts.push(contract.contractName || contract.payerName);
                }
            });

            if (fixedCount > 0) {
                localStorage.setItem('pvContracts', JSON.stringify(contracts));
                const message = `✓ Fixed ${fixedCount} contract(s) and assigned them to "${currentOrg.name}":\n${fixedContracts.join(', ')}`;
                document.getElementById('fix-message').style.display = 'block';
                document.getElementById('fix-message').innerHTML = '<strong>Success!</strong> ' + message.replace(/\n/g, '<br>');
                loadData();
                setTimeout(() => {
                    alert('Contracts fixed! Go back to the main app and refresh the page (Ctrl+Shift+R) to see the changes.');
                }, 500);
            } else {
                alert('No contracts needed fixing. All contracts already have valid organization IDs.');
            }
        }

        function fixPayerOrganizations() {
            const currentOrgData = localStorage.getItem('pvCurrentOrganization');
            if (!currentOrgData) {
                alert('No current organization found. Please select an organization in the main app first.');
                return;
            }

            const currentOrg = JSON.parse(currentOrgData);
            const payersData = localStorage.getItem('pvPayers');

            if (!payersData) {
                alert('No payers found to fix.');
                return;
            }

            const payers = JSON.parse(payersData);
            let fixedCount = 0;
            const fixedPayers = [];

            payers.forEach(payer => {
                if (!payer.organizationId || payer.organizationId === 'null' || payer.organizationId === null) {
                    payer.organizationId = currentOrg.id;
                    fixedCount++;
                    fixedPayers.push(payer.name);
                }
            });

            if (fixedCount > 0) {
                localStorage.setItem('pvPayers', JSON.stringify(payers));
                const message = `✓ Fixed ${fixedCount} payer(s) and assigned them to "${currentOrg.name}":\n${fixedPayers.join(', ')}`;
                document.getElementById('fix-message').style.display = 'block';
                document.getElementById('fix-message').innerHTML = '<strong>Success!</strong> ' + message.replace(/\n/g, '<br>');
                loadData();
                setTimeout(() => {
                    alert('Payers fixed! Go back to the main app and refresh the page (Ctrl+Shift+R) to see the changes.');
                }, 500);
            } else {
                alert('No payers needed fixing. All payers already have valid organization IDs.');
            }
        }

        function fixLocationOrganizations() {
            const currentOrgData = localStorage.getItem('pvCurrentOrganization');
            if (!currentOrgData) {
                alert('No current organization found. Please select an organization in the main app first.');
                return;
            }

            const currentOrg = JSON.parse(currentOrgData);
            const locationsData = localStorage.getItem('pvLocations');

            if (!locationsData) {
                alert('No locations found to fix.');
                return;
            }

            const locations = JSON.parse(locationsData);
            let fixedCount = 0;
            const fixedLocations = [];

            locations.forEach(location => {
                if (!location.organizationId || location.organizationId === 'null' || location.organizationId === null) {
                    location.organizationId = currentOrg.id;
                    fixedCount++;
                    fixedLocations.push(location.name);
                }
            });

            if (fixedCount > 0) {
                localStorage.setItem('pvLocations', JSON.stringify(locations));
                const message = `✓ Fixed ${fixedCount} location(s) and assigned them to "${currentOrg.name}":\n${fixedLocations.join(', ')}`;
                document.getElementById('fix-message').style.display = 'block';
                document.getElementById('fix-message').innerHTML = '<strong>Success!</strong> ' + message.replace(/\n/g, '<br>');
                loadData();
                setTimeout(() => {
                    alert('Locations fixed! Go back to the main app and refresh the page (Ctrl+Shift+R) to see the changes.');
                }, 500);
            } else {
                alert('No locations needed fixing. All locations already have valid organization IDs.');
            }
        }

        // Load data on page load
        loadData();
    </script>
</body>
</html>
